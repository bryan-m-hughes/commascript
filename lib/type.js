"use strict";
Object.defineProperties(exports, {
  BooleanType: {get: function() {
      return BooleanType;
    }},
  NumberType: {get: function() {
      return NumberType;
    }},
  StringType: {get: function() {
      return StringType;
    }},
  ObjectType: {get: function() {
      return ObjectType;
    }},
  RegExpType: {get: function() {
      return RegExpType;
    }},
  NullType: {get: function() {
      return NullType;
    }},
  ArrayType: {get: function() {
      return ArrayType;
    }},
  FunctionType: {get: function() {
      return FunctionType;
    }},
  ConstructorType: {get: function() {
      return ConstructorType;
    }},
  isBoolean: {get: function() {
      return isBoolean;
    }},
  isNumber: {get: function() {
      return isNumber;
    }},
  isString: {get: function() {
      return isString;
    }},
  isPrimitive: {get: function() {
      return isPrimitive;
    }},
  isObject: {get: function() {
      return isObject;
    }},
  isArray: {get: function() {
      return isArray;
    }},
  isFunction: {get: function() {
      return isFunction;
    }},
  isConstructor: {get: function() {
      return isConstructor;
    }},
  compareTypes: {get: function() {
      return compareTypes;
    }},
  __esModule: {value: true}
});
var $__state__;
var $__0 = ($__state__ = require("./state"), $__state__ && $__state__.__esModule && $__state__ || {default: $__state__}),
    handleError = $__0.handleError,
    handleInternalError = $__0.handleInternalError;
var Type = function Type(options) {
  this.name = options.name;
  this.declarationLocation = options.declarationLocation;
};
($traceurRuntime.createClass)(Type, {}, {});
var BooleanType = function BooleanType() {
  $traceurRuntime.superCall(this, $BooleanType.prototype, "constructor", [{name: 'boolean'}]);
};
var $BooleanType = BooleanType;
($traceurRuntime.createClass)(BooleanType, {}, {}, Type);
var NumberType = function NumberType() {
  $traceurRuntime.superCall(this, $NumberType.prototype, "constructor", [{name: 'number'}]);
};
var $NumberType = NumberType;
($traceurRuntime.createClass)(NumberType, {}, {}, Type);
var StringType = function StringType() {
  $traceurRuntime.superCall(this, $StringType.prototype, "constructor", [{name: 'string'}]);
};
var $StringType = StringType;
($traceurRuntime.createClass)(StringType, {}, {}, Type);
var ObjectType = function ObjectType(options) {
  options = options || {};
  $traceurRuntime.superCall(this, $ObjectType.prototype, "constructor", [options.name || 'anonymous object']);
  this.properties = options.properties || {};
  this.proto = options.proto || null;
};
var $ObjectType = ObjectType;
($traceurRuntime.createClass)(ObjectType, {}, {}, Type);
var RegExpType = function RegExpType() {
  $traceurRuntime.superCall(this, $RegExpType.prototype, "constructor", [{name: 'regexp'}]);
};
var $RegExpType = RegExpType;
($traceurRuntime.createClass)(RegExpType, {}, {}, Type);
var NullType = function NullType() {
  $traceurRuntime.superCall(this, $NullType.prototype, "constructor", [{name: 'null'}]);
};
var $NullType = NullType;
($traceurRuntime.createClass)(NullType, {}, {}, Type);
var ArrayType = function ArrayType() {
  if (!options || !options.elementType) {
    handleInternalError('Invalid options passed to ArrayType constructor.');
  }
  $traceurRuntime.superCall(this, $ArrayType.prototype, "constructor", [options.name || 'anonymous array']);
  this.elementType = options.elementType;
};
var $ArrayType = ArrayType;
($traceurRuntime.createClass)(ArrayType, {}, {}, Type);
var FunctionType = function FunctionType(options) {
  if (!options || !options.node) {
    handleInternalError('Invalid options passed to FunctionType constructor.');
  }
  $traceurRuntime.superCall(this, $FunctionType.prototype, "constructor", [options.name || 'anonymous function']);
  this.node = options.node;
  this.argumentTypes = options.arguments || [];
  this.returnType = options.returnType || null;
};
var $FunctionType = FunctionType;
($traceurRuntime.createClass)(FunctionType, {applyPattern: function(options) {
    if (!options || !options.argumentTypes || !options.returnType) {
      handleInternalError('Invalid options passed to FunctionType constructor.');
    }
  }}, {}, Type);
var ConstructorType = function ConstructorType(options) {
  if (!options || !options.name || !options.instantiatedType) {
    handleInternalError('Invalid options passed to ConstructorType constructor.');
  }
  $traceurRuntime.superCall(this, $ConstructorType.prototype, "constructor", [options.name]);
  this.argumentTypes = options.argumentTypes || [];
  this.instantiatedType = options.instantiatedType;
};
var $ConstructorType = ConstructorType;
($traceurRuntime.createClass)(ConstructorType, {}, {}, Type);
function isBoolean(type) {
  return type instanceof BooleanType;
}
function isNumber(type) {
  return type instanceof NumberType;
}
function isString(type) {
  return type instanceof StringType;
}
function isPrimitive(type) {
  return isBoolean(type) || isNumber(type) || isString(type);
}
function isObject(type) {
  return type instanceof ObjectType;
}
function isArray(type) {
  return type instanceof ArrayType;
}
function isFunction(type) {
  return type instanceof FunctionType;
}
function isConstructor(type) {
  return type instanceof ConstructorType;
}
function compareTypes(type1, type2, options) {
  if (!options || !options.node) {
    handleInternalError('Invalid options passed to compareTypes.');
  }
  if (type1 == type2) {
    return true;
  }
  function handleCompareError(errorMessage) {
    handleError(options.node, 'Cannot cast "' + type1.name + '" (declared at ' + type1.declarationLocation + ') as "' + type2.name + '" (declared at ' + type2.declarationLocation + ')' + (errorMessage ? ': ' + errorMessage : ''));
  }
  if (isPrimitive(type1) && isPrimitive(type2)) {
    if ((isBoolean(type1) && isBoolean(type2)) || (isNumber(type1) && isNumber(type2)) || (isString(type1) && isString(type2))) {
      return true;
    } else {
      handleCompareError();
      return false;
    }
  }
  var p;
  if (isObject(type1) && isObject(type2)) {
    if (!compareTypes(type1.proto, type2.proto, options)) {
      return false;
    }
    if (Object.keys(type1.properties).length != Object.keys(type2.properties).length) {
      handleCompareError('Objects do not contain the same number of properties');
      return false;
    }
    for (p in type1.properties) {
      if (!type2.properties[p]) {
        handleCompareError('Object type is missing property "' + p + '"');
        return false;
      }
      if (!compareTypes(type1.properties[p], type2.properties[p], options)) {
        handleCompareError('Property "' + p + '" type mismatch');
        return false;
      }
    }
    return true;
  }
  var i;
  if (isFunction(type1) && isFunction(type2)) {
    if (!compareTypes(type1.returnType, type2.returnType, options)) {
      return false;
    }
    if (type1.argumentTypes.length != type2.argumentTypes.length) {
      handleCompareError('Functions do not contain the same number of arguments');
      return false;
    }
    for (i = 0; i < type1.argumentTypes.length; i++) {
      if (!compareTypes(type1.argumentTypes[i], type2.argumentTypes[i], options)) {
        handleCompareError('Argument "' + i + '" type mismatch');
        return false;
      }
    }
    return true;
  }
  if (isConstructor(type1) && isConstructor(type2)) {
    if (!compareTypes(type1.instantiatedType, type2.instantiatedType, options)) {
      return false;
    }
    if (type1.argumentTypes.length != type2.argumentTypes.length) {
      handleCompareError('Constructors do not contain the same number of arguments');
      return false;
    }
    for (i = 0; i < type1.argumentTypes.length; i++) {
      if (!compareTypes(type1.argumentTypes[i], type2.argumentTypes[i], options)) {
        handleCompareError('Argument "' + i + '" type mismatch');
        return false;
      }
    }
    return true;
  }
  return false;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInR5cGUuanMiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvNiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci80IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzEiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci81IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzAiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvNyIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci84IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzkiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMTEiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMTAiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBd0JBO0FDeEJBLEtBQUssaUJBQWlCLEFBQUMsQ0FBQyxPQUFNO2FDQTlCLEVBQUMsR0FBRSxZQ0FxQjtBQUFFLHdCQUF3QjtJQUFFLEFEQTlCLENBQUM7WUFBdkIsRUFBQyxHQUFFLFlDQXFCO0FBQUUsdUJBQXdCO0lBQUUsQURBOUIsQ0FBQztZQUF2QixFQUFDLEdBQUUsWUNBcUI7QUFBRSx1QkFBd0I7SUFBRSxBREE5QixDQUFDO1lBQXZCLEVBQUMsR0FBRSxZQ0FxQjtBQUFFLHVCQUF3QjtJQUFFLEFEQTlCLENBQUM7WUFBdkIsRUFBQyxHQUFFLFlDQXFCO0FBQUUsdUJBQXdCO0lBQUUsQURBOUIsQ0FBQztVQUF2QixFQUFDLEdBQUUsWUNBcUI7QUFBRSxxQkFBd0I7SUFBRSxBREE5QixDQUFDO1dBQXZCLEVBQUMsR0FBRSxZQ0FxQjtBQUFFLHNCQUF3QjtJQUFFLEFEQTlCLENBQUM7Y0FBdkIsRUFBQyxHQUFFLFlDQXFCO0FBQUUseUJBQXdC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LGNBQWMsT0FBTyxDQUFHO0FBQzVELHVCQUFpQixBQUFDLENBQUMsMERBQXlELENBQUMsQ0FBQztBQUM5RSxXQUFPLE1BQUksQ0FBQztJQUNkO0FBQUEsQUFDQSxRQUFLLENBQUEsRUFBSSxFQUFBLENBQUcsQ0FBQSxDQUFBLEVBQUksQ0FBQSxLQUFJLGNBQWMsT0FBTyxDQUFHLENBQUEsQ0FBQSxFQUFFLENBQUc7QUFDL0MsU0FBSSxDQUFDLFlBQVcsQUFBQyxDQUFDLEtBQUksY0FBYyxDQUFFLENBQUEsQ0FBQyxDQUFHLENBQUEsS0FBSSxjQUFjLENBQUUsQ0FBQSxDQUFDLENBQUcsUUFBTSxDQUFDLENBQUc7QUFDMUUseUJBQWlCLEFBQUMsQ0FBQyxZQUFXLEVBQUksRUFBQSxDQUFBLENBQUksa0JBQWdCLENBQUMsQ0FBQztBQUN4RCxhQUFPLE1BQUksQ0FBQztNQUNkO0FBQUEsSUFDRjtBQUFBLEFBQ0EsU0FBTyxLQUFHLENBQUM7RUFDYjtBQUFBLEFBRUEsT0FBTyxNQUFJLENBQUM7QUFDZDtBQUFBIiwiZmlsZSI6InR5cGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuVGhlIE1JVCBMaWNlbnNlIChNSVQpXG5cbkNvcHlyaWdodCAoYykgMjAxMy0yMDE0IEJyeWFuIEh1Z2hlcyA8YnJ5YW5AdGhlb3JldGljYWxpZGVhdGlvbnMuY29tPiAoaHR0cDovL3RoZW9yZXRpY2FsaWRlYXRpb25zLmNvbSlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuVEhFIFNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHsgaGFuZGxlRXJyb3IsIGhhbmRsZUludGVybmFsRXJyb3IgfSBmcm9tICcuL3N0YXRlJztcblxuY2xhc3MgVHlwZSB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLm5hbWUgPSBvcHRpb25zLm5hbWU7XG4gICAgdGhpcy5kZWNsYXJhdGlvbkxvY2F0aW9uID0gb3B0aW9ucy5kZWNsYXJhdGlvbkxvY2F0aW9uO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBCb29sZWFuVHlwZSBleHRlbmRzIFR5cGUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcih7IG5hbWU6ICdib29sZWFuJyB9KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgTnVtYmVyVHlwZSBleHRlbmRzIFR5cGUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBzdXBlcih7IG5hbWU6ICdudW1iZXInIH0pO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBTdHJpbmdUeXBlIGV4dGVuZHMgVHlwZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHsgbmFtZTogJ3N0cmluZycgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE9iamVjdFR5cGUgZXh0ZW5kcyBUeXBlIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHN1cGVyKG9wdGlvbnMubmFtZSB8fCAnYW5vbnltb3VzIG9iamVjdCcpO1xuICAgIHRoaXMucHJvcGVydGllcyA9IG9wdGlvbnMucHJvcGVydGllcyB8fCB7fTtcbiAgICB0aGlzLnByb3RvID0gb3B0aW9ucy5wcm90byB8fCBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBSZWdFeHBUeXBlIGV4dGVuZHMgVHlwZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHsgbmFtZTogJ3JlZ2V4cCcgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIE51bGxUeXBlIGV4dGVuZHMgVHlwZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKHsgbmFtZTogJ251bGwnIH0pO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBBcnJheVR5cGUgZXh0ZW5kcyBUeXBlIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLmVsZW1lbnRUeXBlKSB7XG4gICAgaGFuZGxlSW50ZXJuYWxFcnJvcignSW52YWxpZCBvcHRpb25zIHBhc3NlZCB0byBBcnJheVR5cGUgY29uc3RydWN0b3IuJyk7XG4gIH1cbiAgc3VwZXIob3B0aW9ucy5uYW1lIHx8ICdhbm9ueW1vdXMgYXJyYXknKTtcbiAgdGhpcy5lbGVtZW50VHlwZSA9IG9wdGlvbnMuZWxlbWVudFR5cGU7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIEZ1bmN0aW9uVHlwZSBleHRlbmRzIFR5cGUge1xuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLm5vZGUpIHtcbiAgICAgIGhhbmRsZUludGVybmFsRXJyb3IoJ0ludmFsaWQgb3B0aW9ucyBwYXNzZWQgdG8gRnVuY3Rpb25UeXBlIGNvbnN0cnVjdG9yLicpO1xuICAgIH1cbiAgICBzdXBlcihvcHRpb25zLm5hbWUgfHwgJ2Fub255bW91cyBmdW5jdGlvbicpO1xuICAgIHRoaXMubm9kZSA9IG9wdGlvbnMubm9kZTtcbiAgICB0aGlzLmFyZ3VtZW50VHlwZXMgPSBvcHRpb25zLmFyZ3VtZW50cyB8fCBbXTtcbiAgICB0aGlzLnJldHVyblR5cGUgPSBvcHRpb25zLnJldHVyblR5cGUgfHwgbnVsbDtcbiAgfVxuICBhcHBseVBhdHRlcm4ob3B0aW9ucykge1xuICAgIGlmICghb3B0aW9ucyB8fCAhb3B0aW9ucy5hcmd1bWVudFR5cGVzIHx8ICFvcHRpb25zLnJldHVyblR5cGUpIHtcbiAgICAgIGhhbmRsZUludGVybmFsRXJyb3IoJ0ludmFsaWQgb3B0aW9ucyBwYXNzZWQgdG8gRnVuY3Rpb25UeXBlIGNvbnN0cnVjdG9yLicpO1xuICAgIH1cbiAgICAvLyBUT0RPOiBUaGlzIGlzIGNhbGxlZCBieSBjYWxsIGV4cHJlc3Npb25zIHRvIHNvbGlkaWZ5IHR5cGVzLiBBbmFsYXl6ZXMgZnVuY3Rpb24gYXQgdGhpcyBwb2ludCBpbiB0aW1lLlxuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBDb25zdHJ1Y3RvclR5cGUgZXh0ZW5kcyBUeXBlIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIGlmICghb3B0aW9ucyB8fCAhb3B0aW9ucy5uYW1lIHx8ICFvcHRpb25zLmluc3RhbnRpYXRlZFR5cGUpIHtcbiAgICAgIGhhbmRsZUludGVybmFsRXJyb3IoJ0ludmFsaWQgb3B0aW9ucyBwYXNzZWQgdG8gQ29uc3RydWN0b3JUeXBlIGNvbnN0cnVjdG9yLicpO1xuICAgIH1cbiAgICBzdXBlcihvcHRpb25zLm5hbWUpO1xuICAgIHRoaXMuYXJndW1lbnRUeXBlcyA9IG9wdGlvbnMuYXJndW1lbnRUeXBlcyB8fCBbXTtcbiAgICB0aGlzLmluc3RhbnRpYXRlZFR5cGUgPSBvcHRpb25zLmluc3RhbnRpYXRlZFR5cGU7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQm9vbGVhbih0eXBlKSB7XG4gIHJldHVybiB0eXBlIGluc3RhbmNlb2YgQm9vbGVhblR5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc051bWJlcih0eXBlKSB7XG4gIHJldHVybiB0eXBlIGluc3RhbmNlb2YgTnVtYmVyVHlwZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzU3RyaW5nKHR5cGUpIHtcbiAgcmV0dXJuIHR5cGUgaW5zdGFuY2VvZiBTdHJpbmdUeXBlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQcmltaXRpdmUodHlwZSkge1xuICByZXR1cm4gaXNCb29sZWFuKHR5cGUpIHx8IGlzTnVtYmVyKHR5cGUpIHx8IGlzU3RyaW5nKHR5cGUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNPYmplY3QodHlwZSkge1xuICByZXR1cm4gdHlwZSBpbnN0YW5jZW9mIE9iamVjdFR5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FycmF5KHR5cGUpIHtcbiAgcmV0dXJuIHR5cGUgaW5zdGFuY2VvZiBBcnJheVR5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0Z1bmN0aW9uKHR5cGUpIHtcbiAgcmV0dXJuIHR5cGUgaW5zdGFuY2VvZiBGdW5jdGlvblR5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0NvbnN0cnVjdG9yKHR5cGUpIHtcbiAgcmV0dXJuIHR5cGUgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvclR5cGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wYXJlVHlwZXModHlwZTEsIHR5cGUyLCBvcHRpb25zKSB7XG5cbiAgaWYgKCFvcHRpb25zIHx8ICFvcHRpb25zLm5vZGUpIHtcbiAgICBoYW5kbGVJbnRlcm5hbEVycm9yKCdJbnZhbGlkIG9wdGlvbnMgcGFzc2VkIHRvIGNvbXBhcmVUeXBlcy4nKTtcbiAgfVxuICBpZiAodHlwZTEgPT0gdHlwZTIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZUNvbXBhcmVFcnJvcihlcnJvck1lc3NhZ2UpIHtcbiAgICBoYW5kbGVFcnJvcihvcHRpb25zLm5vZGUsICdDYW5ub3QgY2FzdCBcIicgKyB0eXBlMS5uYW1lICsgJ1wiIChkZWNsYXJlZCBhdCAnICsgdHlwZTEuZGVjbGFyYXRpb25Mb2NhdGlvbiArXG4gICAgICAnKSBhcyBcIicgKyB0eXBlMi5uYW1lICsgJ1wiIChkZWNsYXJlZCBhdCAnICsgdHlwZTIuZGVjbGFyYXRpb25Mb2NhdGlvbiArICcpJyArXG4gICAgICAoZXJyb3JNZXNzYWdlID8gJzogJyArIGVycm9yTWVzc2FnZSA6ICcnKSk7XG4gIH1cblxuICBpZiAoaXNQcmltaXRpdmUodHlwZTEpICYmIGlzUHJpbWl0aXZlKHR5cGUyKSkge1xuICAgIGlmICgoaXNCb29sZWFuKHR5cGUxKSAmJiBpc0Jvb2xlYW4odHlwZTIpKSB8fFxuICAgICAgKGlzTnVtYmVyKHR5cGUxKSAmJiBpc051bWJlcih0eXBlMikpIHx8XG4gICAgICAoaXNTdHJpbmcodHlwZTEpICYmIGlzU3RyaW5nKHR5cGUyKSlcbiAgICApIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBoYW5kbGVDb21wYXJlRXJyb3IoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICB2YXIgcDtcbiAgaWYgKGlzT2JqZWN0KHR5cGUxKSAmJiBpc09iamVjdCh0eXBlMikpIHtcbiAgICBpZiAoIWNvbXBhcmVUeXBlcyh0eXBlMS5wcm90bywgdHlwZTIucHJvdG8sIG9wdGlvbnMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmIChPYmplY3Qua2V5cyh0eXBlMS5wcm9wZXJ0aWVzKS5sZW5ndGggIT0gT2JqZWN0LmtleXModHlwZTIucHJvcGVydGllcykubGVuZ3RoKSB7XG4gICAgICBoYW5kbGVDb21wYXJlRXJyb3IoJ09iamVjdHMgZG8gbm90IGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChwIGluIHR5cGUxLnByb3BlcnRpZXMpIHtcbiAgICAgIGlmICghdHlwZTIucHJvcGVydGllc1twXSkge1xuICAgICAgICBoYW5kbGVDb21wYXJlRXJyb3IoJ09iamVjdCB0eXBlIGlzIG1pc3NpbmcgcHJvcGVydHkgXCInICsgcCArICdcIicpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoIWNvbXBhcmVUeXBlcyh0eXBlMS5wcm9wZXJ0aWVzW3BdLCB0eXBlMi5wcm9wZXJ0aWVzW3BdLCBvcHRpb25zKSkge1xuICAgICAgICBoYW5kbGVDb21wYXJlRXJyb3IoJ1Byb3BlcnR5IFwiJyArIHAgKyAnXCIgdHlwZSBtaXNtYXRjaCcpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLy8gVE9ETzogTmVlZCB0byByZXRoaW5rIGluIHRlcm1zIG9mIHBhcnRpYWwgZGVmaW5pdGlvbnNcbiAgdmFyIGk7XG4gIGlmIChpc0Z1bmN0aW9uKHR5cGUxKSAmJiBpc0Z1bmN0aW9uKHR5cGUyKSkge1xuICAgIGlmICghY29tcGFyZVR5cGVzKHR5cGUxLnJldHVyblR5cGUsIHR5cGUyLnJldHVyblR5cGUsIG9wdGlvbnMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0eXBlMS5hcmd1bWVudFR5cGVzLmxlbmd0aCAhPSB0eXBlMi5hcmd1bWVudFR5cGVzLmxlbmd0aCkge1xuICAgICAgaGFuZGxlQ29tcGFyZUVycm9yKCdGdW5jdGlvbnMgZG8gbm90IGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cycpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGkgPSAwOyBpIDwgdHlwZTEuYXJndW1lbnRUeXBlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjb21wYXJlVHlwZXModHlwZTEuYXJndW1lbnRUeXBlc1tpXSwgdHlwZTIuYXJndW1lbnRUeXBlc1tpXSwgb3B0aW9ucykpIHtcbiAgICAgICAgaGFuZGxlQ29tcGFyZUVycm9yKCdBcmd1bWVudCBcIicgKyBpICsgJ1wiIHR5cGUgbWlzbWF0Y2gnKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmIChpc0NvbnN0cnVjdG9yKHR5cGUxKSAmJiBpc0NvbnN0cnVjdG9yKHR5cGUyKSkge1xuICAgIGlmICghY29tcGFyZVR5cGVzKHR5cGUxLmluc3RhbnRpYXRlZFR5cGUsIHR5cGUyLmluc3RhbnRpYXRlZFR5cGUsIG9wdGlvbnMpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0eXBlMS5hcmd1bWVudFR5cGVzLmxlbmd0aCAhPSB0eXBlMi5hcmd1bWVudFR5cGVzLmxlbmd0aCkge1xuICAgICAgaGFuZGxlQ29tcGFyZUVycm9yKCdDb25zdHJ1Y3RvcnMgZG8gbm90IGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIGFyZ3VtZW50cycpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGkgPSAwOyBpIDwgdHlwZTEuYXJndW1lbnRUeXBlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjb21wYXJlVHlwZXModHlwZTEuYXJndW1lbnRUeXBlc1tpXSwgdHlwZTIuYXJndW1lbnRUeXBlc1tpXSwgb3B0aW9ucykpIHtcbiAgICAgICAgaGFuZGxlQ29tcGFyZUVycm9yKCdBcmd1bWVudCBcIicgKyBpICsgJ1wiIHR5cGUgbWlzbWF0Y2gnKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBmYWxzZTtcbn1cbiIsIk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKGV4cG9ydHMsICRfX3BsYWNlaG9sZGVyX18wKTsiLCJ7Z2V0OiAkX19wbGFjZWhvbGRlcl9fMH0iLCJnZXQgJF9fcGxhY2Vob2xkZXJfXzAoKSB7IHJldHVybiAkX19wbGFjZWhvbGRlcl9fMTsgfSIsIl9fZXNNb2R1bGU6IHRydWUiLCJ7dmFsdWU6ICRfX3BsYWNlaG9sZGVyX18wfSIsIigkX19wbGFjZWhvbGRlcl9fMCA9IHJlcXVpcmUoJF9fcGxhY2Vob2xkZXJfXzEpLCBcbiAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzIgJiYgJF9fcGxhY2Vob2xkZXJfXzMuX19lc01vZHVsZSAmJiAkX19wbGFjZWhvbGRlcl9fNCB8fCB7ZGVmYXVsdDogJF9fcGxhY2Vob2xkZXJfXzV9KSIsInZhciAkX19wbGFjZWhvbGRlcl9fMCA9ICRfX3BsYWNlaG9sZGVyX18xIiwiKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoJF9fcGxhY2Vob2xkZXJfXzAsICRfX3BsYWNlaG9sZGVyX18xLCAkX19wbGFjZWhvbGRlcl9fMikiLCIkdHJhY2V1clJ1bnRpbWUuc3VwZXJDYWxsKCRfX3BsYWNlaG9sZGVyX18wLCAkX19wbGFjZWhvbGRlcl9fMSwgJF9fcGxhY2Vob2xkZXJfXzIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfX3BsYWNlaG9sZGVyX18zKSIsInZhciAkX19wbGFjZWhvbGRlcl9fMCA9ICRfX3BsYWNlaG9sZGVyX18xIiwiKCR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcykoJF9fcGxhY2Vob2xkZXJfXzAsICRfX3BsYWNlaG9sZGVyX18xLCAkX19wbGFjZWhvbGRlcl9fMixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfX3BsYWNlaG9sZGVyX18zKSJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==